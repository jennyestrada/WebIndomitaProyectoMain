<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css/styles.css">
    
    
     <script type="text/javascript">
  
	// 1.abrimos script
	// 2.al cargar la ventana extraemos los parametros de OP y ID de la URL 
	// necearios para comunicar al SERVLET que OPCION ejecutar y la Id del articulo a editar.
	
		window.onload = function(){
	// 3.al cargar la ventana extraemos los parametros de OP y ID de la URL 
	// que quedaran en la variable parametersGet.
	let queryStrings = new URLSearchParams(window.location.search);
	let parametersGet = Object.fromEntries(queryStrings.entries());
	console.log(parametersGet);	
	
	
	// 4. identificamos la OPCION si es op 2 entra en el if, tenemos que crear el campo HIDDEN.
    	 document.getElementById("hiddenOp").value = parametersGet.op;
    	 
    	 if (parametersGet.op === '2'){
			 
			 	// 3. Creo un objeto de javaScript tipo XMLHttpRequest
		let xhr = new XMLHttpRequest();
		// 4. Creo un var para meter lo que traer el JSON
		let resultadito;
		
		 // 5 . onreadystatechange este metodo revisa los estados de la conexion la final
		 // es la 4, la que le interesa si manda un 200 quiere decir que todo va bien
		 // solo que no lo vemos como el 404.
		 
		 	 xhr.onreadystatechange = function () {
				  if (xhr.readyState === 4){
					if (xhr.status === 200){
						
						// 6 . Si el estado es 200, mete los datos que vienen en el JSON
						// desde el servlet en la variable resultadito.
						
						resultadito = JSON.parse(xhr.responseText);  	
					}	  	
				  }
				  
			  };
			          
       // 6. Ponemos GET porque para traer los datos usamos el metodo doGET
       // tambien ponemos el nombre del Servlet indicando el ID que sacamos de la URL.
       
       // 7 . le doy como parametro results, aqui estaria los datos metidos   
       // y se mostraran en los cada input
       // al  hiddenId se le asigna el id que se extrae en de la URL
		
               xhr.open("GET", "ServletNoticiasDOS?id=" + parametersGet.id, false);
               xhr.setRequestHeader("Content-Type", "application/json");// esto es opcional
               xhr.send();
               
               document.getElementById("title").value = resultadito.title;
               document.getElementById("text").value = resultadito.text;
               document.getElementById("hiddenId").value = parametersGet.id;
               console.log(resultadito)
               
        // 8. al hiddenId le damos el id que venia en la URL este esta en
        // la variable parametersGet.  lo mismo para OP.
        
        // 9. creo el formulario y asigno los id. 
        
        // 10. anado dos campos para id y para op y lo llenamos con los parametros de la 
        // URL.
        // <input id="hiddenOp" type="hidden" name="op" value="">
    	// <input id="hiddenId" type="hidden" name="id" value="-1">   
	
         }
			 
	}
    	 
</script>

</head>  

<body>
	
	
	
	<div class="container">
		

	<form action="ServletNoticiasDOS" method="post" enctype="multipart/form-data">
		
		  

    <input id="hiddenOp" type="hidden" name="op" value="">
    <input id="hiddenId" type="hidden" name="id" value="-1">

		
		<div>
			<h3>TITULO</h3>
			<textarea id="title" name="title"></textarea>
			
		</div>
		
		<div>
			<p>TEXTO</p>
			<textarea id="text" name="text"></textarea>
			
		</div>
	
		
		
		 <div class="flex-column--85">
            <input type="file" name="image"> 
         </div> 
         
         <button type="submit">PUBLICAR NOTICIA</button>
		
	</form>	
		
		
	</form>
	
	</div>
	
	
	
	
</body>

 
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
</html>