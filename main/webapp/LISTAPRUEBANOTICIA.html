<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css/styles.css">
    
    
  
    
    <script type="text/javascript">
		
		// 1. abrimos script
		// 2. Que cuando se cargue se ejecute la funcion.
		window.onload = function(){
		
		// 3. Creo un objeto de javaScript tipo XMLHttpRequest
		let xhr = new XMLHttpRequest();
		// 4. Creo un var para meter lo que traer el JSON
		let resultadito;
		
		 // 5 . onreadystatechange este metodo revisa los estados de la conexion la final
		 // es la 4, la que le interesa si manda un 200 quiere decir que todo va bien
		 // solo que no lo vemos como el 404.
		 
		 	 xhr.onreadystatechange = function () {
				  if (xhr.readyState === 4){
					if (xhr.status === 200){
						
						// 6 . Si el estado es 200, mete los datos que vienen en el JSON
						// desde el servlet en la variable resultadito.
						
						resultadito = JSON.parse(xhr.responseText);  	
					}	  	
				  }
				  
			  };
			  
			  
		 // 7 . Hora de traer los datos mediante el uso del GET, 
		 // ya que en el servlet trae los datos por el doGET.
		 // ponemos el nombre del servlet tambien.
		 
		 
		 xhr.open("GET","ServletListaNoticias", false);
		 xhr.setRequestHeader("Content-Type", "application/json");// esto es opcional
         xhr.send();
         console.log(resultadito)
         // 8 - llamo a la funcion Paint 
         // le doy como parametro resultaditos.
         paint(resultadito);
         
         // cierro el window.onload
         }
         
         
         // 9. Creo la funcion paint y lo aplicamos a todo el html 
         // dinamico.
         
         function  paint(resultadito){
			 
		// 10. Creo una var html, que se aplica a todo el html dinamico
		let html = "";
		
			for (let i=0;i<resultadito.length; i++){
				
				// 11. mostramos  lista de titulo noticias.
				html += '<div id="#" class="menu-box__links main-paragraph--blue">'
				html += '<a href="#"><p>' + resultadito[i].title +'</p></a>'
				html += '</div>'
				
				// 12. creamos boton ELIMINAR, este se comunica directa/ con el servlet
				// y su metodo borrar. para ello necesitamo un form y su action.
				// en este formulario iran el ID del articulo, y la opcion de borrar.
				// ambos en un campo oculto o hidden.
				
				html += '<form action="ServletNoticiasDOS" method="post" enctype="multipart/form-data">'	
				html += '<button class="primary-button mt-15 width-100 d-block"  type="submit">ELIMINAR NOTICIA</button>'
					// id y su valor que esta en el array resultadito.
					html += '<input type="hidden" name="id"  value="'+ resultadito[i].id + '">';
					html += '<input type="hidden" name="op"  value="3">';
				html += '</form>'
				
				
				
				// 13. creamos boton EDITAR, NO se comunica directa/ con el servlet
				// en este caso creamos un LINK que ira a la pagina NoticiasEditor.html
				// este recibira la URL con los parametros necesarios. 
				// esta pagina se comunica con el SERVLET.
				
				
				
				html += '<a href="EDITORNOTICIAS.html?id='+ resultadito[i].id + '&op=2"><button type="button">EDITAR NOTICIA</button></a>';
				
				// 14. desde la pagina editar debemos sacar los parametros que interesa, ID y OP para que des
				// desde aqui se comunique con el SERVLET y ejecute la opcion 2.
				
				
					
				
			}
		
		document.getElementById("NoticiaLista").innerHTML=html;	 
		}
		
		
	</script>
	
	
	
	
	
	</head>
<body>
    <nav>
        <div class="header-logo" >
         <img class="responsive-image" src="/imagenes/logo indomita.png" alt="logo indomita">
         </div>
         <div>
             <ul class="nav-links"> 
                 <li ><a href="#"><p>Cerrar sesi√≥n</p></a></li>
              </ul>        
         </div>       
     </nav>
     
     
     
     
	 <div class="container">
		
	

		
		<h1 class="main-title">LISTA DE ARTICULOS</h1>
	         
	    <div id="NoticiaLista">
			
		</div>

	</div>
                       
	
	
	
	
	
	
	
	